#pragma config(Sensor, S1,     lichtsensor,    sensorLightActive)
#pragma config(Sensor, S2,     zonar,          sensorSONAR)
#pragma config(Sensor, S4,     kleursensor,    sensorColorNxtFULL)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#define snelheidslimiet 35

int PowerA;
int PowerB;
int Tp = 0;

task accelerate()
{
	for (int i = 0; i <= snelheidslimiet; i++)
	{
		wait10Msec(8);
		Tp = i;
	}
}

task geluid()
{
	while(1)
	{
		if (PowerA != 0 && PowerB != 0)
		{
			playSoundFile("paardg.rso");
			nVolume = 4;
		}
	}
}

task main()
{
	startTask(geluid);
	startTask(accelerate);
	int Kp = 2.5;
	int offset = 49;
	while (true)
	{
		while (SensorValue(zonar) > 10)
		{
			while (SensorValue(kleursensor) != BLACKCOLOR && (SensorValue(lichtsensor) != 49))
			{
				nVolume = 4;
				int LightValue = SensorValue(lichtsensor);
				int error = LightValue - offset;
				int Turn = Kp * error;
				PowerA = Tp - Turn;
				PowerB = Tp + Turn;
				motor[motorA] = PowerA;
				motor[motorB] = PowerB;
			}
			motor[motorA] = 0;
			motor[motorB] = 0;
			nVolume = 0;
		}
		motor[motorA] = 0;
		motor[motorB] = 0;
		nVolume = 0;
	}
}
